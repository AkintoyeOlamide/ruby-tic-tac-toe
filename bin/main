#!/usr/bin/env ruby
require_relative("../lib/players.rb")
require_relative("../lib/board.rb")
def validate_name(name, prev_player = nil)
  if prev_player == nil
    if !name.empty? && name.length.between?(3,20)
      true
    else false
    end
  elsif prev_player == "player1"
    if !name.empty? && name.length.between?(3,20) && name.capitalize != $player1_name
    true
    else false
    end
  end
end
def player_name(player_name)
  p "Hey #{player_name}, whats your name?"
  name = gets.chomp
  if player_name == "player1"
    if  validate_name(name)
    name
    else
      puts "invalid name, player name must be unique and between 3-20 letters"
      player_name(player_name)
    end
  elsif player_name == "player2"
    if  validate_name(name,"player1")
    name
    else
      puts "invalid name, player name must be unique and between 3-20 letters"
      player_name(player_name)
    end
  end 
end

def player_token(player_name)
  p "Hello #{player_name}, Please select a token X or O"
  token = gets.chomp
  if Players.validate_token?(token)
    p "#{token.upcase!}, Nice choice!"
    return token.capitalize
  else
    p "Invalid token, please choose X or O"
    player_token(player_name)
  end
end

$player1_name = player_name("player1").capitalize
player1_token = player_token($player1_name)
player1 = Players.new($player1_name, player1_token)

player2_name = player_name("player2").capitalize
player2_token = ["x","X"].include?(player2_token) ? "X" : "O"
puts "hey #{player2_name}, your token is #{player2_token.capitalize}."
player2 = Players.new(player2_name, player2_token)

players = [{ name: player1.name, token: player1_token }, { name: player2.name, token: player2_token }]

board = Board.new(players)



  
while board.game_over == false
  current_player_turn = board.players[board.current_player][:name]
  puts "#{current_player_turn} Please select a number from the board:"
  select_number = gets.chomp.to_i
    if board.position_validation?(select_number)
      board.change_board(select_number)
      board.board_display.each { |n| p n }
    else
      puts "invalid position"
      next
    end
end